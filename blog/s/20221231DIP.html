<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.53">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://shao.fun/blog/s/20221231DIP.html"><meta property="og:site_name" content="HK-SHAO"><meta property="og:title" content="数字图像处理基础大作业"><meta property="og:description" content="mim2 自发光、辉光、镜中镜 查看目录 [[TOC]] 前言 亲爱的 XX 老师，这次大作业我会主要介绍我在这两周自行从零实现的一个 PT Renderer (路径追踪渲染器)，涉及的主要工作是计算机伪随机数生成、三维空间中的变换、蒙特卡洛、图像采样、图像预处理、双向散射分布函数、有向距离场函数和求交、计算成像、基于物理的渲染、基础光学原理、色调映射..."><meta property="og:type" content="article"><meta property="og:image" content="https://shao.fun/"><meta property="og:updated_time" content="2023-01-01T16:02:40.000Z"><meta property="og:locale" content="zh-CN"><meta name="twitter:creator" content="HKSHAO"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="数字图像处理基础大作业"><meta property="article:author" content="HK-SHAO"><meta property="article:modified_time" content="2023-01-01T16:02:40.000Z"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#ffffff"><meta name="keywords" content="烧风, shaofun, hk-shao, hk_shao, HK-SHAO"><meta name="description" content="烧风(HK-SHAO, shaofun)的个人网站/主页，分享一些技术文档/文章和我的作品"><meta name="baidu-site-verification" content="code-9JVoVoLVMg"><title>数字图像处理基础大作业 | HK-SHAO</title>
    <link rel="preload" href="/assets/style.64f441e1.css" as="style" /><link rel="stylesheet" href="/assets/style.64f441e1.css" />
    <link rel="modulepreload" href="/assets/app.d9ef6744.js"><link rel="modulepreload" href="/assets/20221231DIP.html.ed76f6af.js"><link rel="modulepreload" href="/assets/12.8e135511.js"><link rel="modulepreload" href="/assets/20221231DIP.html.34852c83.js"><link rel="prefetch" href="/assets/LICENSE.html.82b0492a.js" as="script" /><link rel="prefetch" href="/assets/index.html.fa1df886.js" as="script" /><link rel="prefetch" href="/assets/index.html.eb6fb661.js" as="script" /><link rel="prefetch" href="/assets/index.html.33f0646a.js" as="script" /><link rel="prefetch" href="/assets/index.html.c810655d.js" as="script" /><link rel="prefetch" href="/assets/index.html.86588f8b.js" as="script" /><link rel="prefetch" href="/assets/index.html.43963326.js" as="script" /><link rel="prefetch" href="/assets/index.html.08b72ec9.js" as="script" /><link rel="prefetch" href="/assets/license.html.481c976a.js" as="script" /><link rel="prefetch" href="/assets/my-sandbox-game.html.bdc9bc28.js" as="script" /><link rel="prefetch" href="/assets/resume-mind.html.a5d30c4f.js" as="script" /><link rel="prefetch" href="/assets/advanced-use-of-markdown.html.f7675639.js" as="script" /><link rel="prefetch" href="/assets/basic-tutorial-for-markdown.html.6c1cd403.js" as="script" /><link rel="prefetch" href="/assets/how-to-use-markdown.html.884a1e1d.js" as="script" /><link rel="prefetch" href="/assets/labor-demand-based-distribution.html.29d37474.js" as="script" /><link rel="prefetch" href="/assets/taichi-lang-cheatsheet-svg.html.6fbc349b.js" as="script" /><link rel="prefetch" href="/assets/use-echarts-in-markdown.html.dc1e82e3.js" as="script" /><link rel="prefetch" href="/assets/use-mermaid-in-markdwon.html.eaa3a36a.js" as="script" /><link rel="prefetch" href="/assets/149-cornell-box.html.14462cf3.js" as="script" /><link rel="prefetch" href="/assets/ask-new-bing.html.441cba43.js" as="script" /><link rel="prefetch" href="/assets/english-grammar-summary.html.9de75c63.js" as="script" /><link rel="prefetch" href="/assets/glsl-canvas-and-editor.html.3d3abeb9.js" as="script" /><link rel="prefetch" href="/assets/godot-cube-4d.html.35c06455.js" as="script" /><link rel="prefetch" href="/assets/godot-ray-tracing.html.d58c9aaa.js" as="script" /><link rel="prefetch" href="/assets/godot-smooth-brush.html.ee1c00ea.js" as="script" /><link rel="prefetch" href="/assets/how-diffusion-models-work.html.7e26a92a.js" as="script" /><link rel="prefetch" href="/assets/ray-tracing-denoise.html.698a2220.js" as="script" /><link rel="prefetch" href="/assets/some-godot-tips.html.c532aa44.js" as="script" /><link rel="prefetch" href="/assets/some-math-examples.html.d086b0bf.js" as="script" /><link rel="prefetch" href="/assets/taichi-ray-tracing.html.0f230221.js" as="script" /><link rel="prefetch" href="/assets/index.html.fcec69cc.js" as="script" /><link rel="prefetch" href="/assets/index.html.d389a2de.js" as="script" /><link rel="prefetch" href="/assets/index.html.18082d6b.js" as="script" /><link rel="prefetch" href="/assets/404.html.4272d91a.js" as="script" /><link rel="prefetch" href="/assets/LICENSE.html.100b10f1.js" as="script" /><link rel="prefetch" href="/assets/index.html.920c7810.js" as="script" /><link rel="prefetch" href="/assets/index.html.0fe94629.js" as="script" /><link rel="prefetch" href="/assets/index.html.3051f797.js" as="script" /><link rel="prefetch" href="/assets/index.html.511c0314.js" as="script" /><link rel="prefetch" href="/assets/index.html.8facf8be.js" as="script" /><link rel="prefetch" href="/assets/index.html.e78a5959.js" as="script" /><link rel="prefetch" href="/assets/index.html.351a0b04.js" as="script" /><link rel="prefetch" href="/assets/license.html.e3140cb1.js" as="script" /><link rel="prefetch" href="/assets/my-sandbox-game.html.3a9a6204.js" as="script" /><link rel="prefetch" href="/assets/resume-mind.html.1407f816.js" as="script" /><link rel="prefetch" href="/assets/advanced-use-of-markdown.html.9a2d6427.js" as="script" /><link rel="prefetch" href="/assets/basic-tutorial-for-markdown.html.eb468564.js" as="script" /><link rel="prefetch" href="/assets/how-to-use-markdown.html.fae92592.js" as="script" /><link rel="prefetch" href="/assets/labor-demand-based-distribution.html.7811d1f9.js" as="script" /><link rel="prefetch" href="/assets/taichi-lang-cheatsheet-svg.html.7860c6d6.js" as="script" /><link rel="prefetch" href="/assets/use-echarts-in-markdown.html.b806fb60.js" as="script" /><link rel="prefetch" href="/assets/use-mermaid-in-markdwon.html.e81295a7.js" as="script" /><link rel="prefetch" href="/assets/149-cornell-box.html.5e9acb97.js" as="script" /><link rel="prefetch" href="/assets/ask-new-bing.html.1c4bede7.js" as="script" /><link rel="prefetch" href="/assets/english-grammar-summary.html.502f8281.js" as="script" /><link rel="prefetch" href="/assets/glsl-canvas-and-editor.html.ef8f25b8.js" as="script" /><link rel="prefetch" href="/assets/godot-cube-4d.html.d1c58c1f.js" as="script" /><link rel="prefetch" href="/assets/godot-ray-tracing.html.89eaed44.js" as="script" /><link rel="prefetch" href="/assets/godot-smooth-brush.html.86d21e36.js" as="script" /><link rel="prefetch" href="/assets/how-diffusion-models-work.html.20bc7992.js" as="script" /><link rel="prefetch" href="/assets/ray-tracing-denoise.html.6c73261c.js" as="script" /><link rel="prefetch" href="/assets/some-godot-tips.html.d9a1a434.js" as="script" /><link rel="prefetch" href="/assets/some-math-examples.html.8ae0d933.js" as="script" /><link rel="prefetch" href="/assets/taichi-ray-tracing.html.61887167.js" as="script" /><link rel="prefetch" href="/assets/index.html.04f84d58.js" as="script" /><link rel="prefetch" href="/assets/index.html.f386496e.js" as="script" /><link rel="prefetch" href="/assets/index.html.cbfa52ce.js" as="script" /><link rel="prefetch" href="/assets/404.html.dd063ed5.js" as="script" /><link rel="prefetch" href="/assets/index.0e8935cb.js" as="script" /><link rel="prefetch" href="/assets/index.cac02f97.js" as="script" /><link rel="prefetch" href="/assets/flowchart.parse.ee90d7e0.js" as="script" /><link rel="prefetch" href="/assets/mermaid.esm.min.6ea8f3e9.js" as="script" /><link rel="prefetch" href="/assets/mermaid-mindmap.esm.min.401ec564.js" as="script" /><link rel="prefetch" href="/assets/highlight.esm.bbe50b4b.js" as="script" /><link rel="prefetch" href="/assets/markdown.esm.28286a51.js" as="script" /><link rel="prefetch" href="/assets/math.esm.137065e8.js" as="script" /><link rel="prefetch" href="/assets/notes.esm.70909847.js" as="script" /><link rel="prefetch" href="/assets/reveal.esm.dd8bfc4c.js" as="script" /><link rel="prefetch" href="/assets/search.esm.9d0cc719.js" as="script" /><link rel="prefetch" href="/assets/zoom.esm.e108c3af.js" as="script" /><link rel="prefetch" href="/assets/giscus.468808e8.js" as="script" />
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="HK-SHAO"><span class="site-name can-hide">HK-SHAO</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="router-link-active" aria-label="博文"><!--[--><!--]--> 博文 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="链接"><!--[--><!--]--> 链接 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/about/" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/HK-SHAO" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/" class="router-link-active" aria-label="博文"><!--[--><!--]--> 博文 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="链接"><!--[--><!--]--> 链接 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/about/" class="" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/HK-SHAO" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">数字图像处理基础大作业 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/s/20221231DIP.html#前言" class="router-link-active router-link-exact-active sidebar-item" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#选题" class="router-link-active router-link-exact-active sidebar-item" aria-label="选题"><!--[--><!--]--> 选题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#工具" class="router-link-active router-link-exact-active sidebar-item" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#基础原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础原理"><!--[--><!--]--> 基础原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#算法难点" class="router-link-active router-link-exact-active sidebar-item" aria-label="算法难点"><!--[--><!--]--> 算法难点 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/s/20221231DIP.html#光线与物体求交" class="router-link-active router-link-exact-active sidebar-item" aria-label="光线与物体求交"><!--[--><!--]--> 光线与物体求交 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#光线与物体材质交互" class="router-link-active router-link-exact-active sidebar-item" aria-label="光线与物体材质交互"><!--[--><!--]--> 光线与物体材质交互 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#双向散射率分布函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="双向散射率分布函数"><!--[--><!--]--> 双向散射率分布函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#摄像机表示" class="router-link-active router-link-exact-active sidebar-item" aria-label="摄像机表示"><!--[--><!--]--> 摄像机表示 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#图像处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="图像处理"><!--[--><!--]--> 图像处理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/s/20221231DIP.html#基于图像的照明" class="router-link-active router-link-exact-active sidebar-item" aria-label="基于图像的照明"><!--[--><!--]--> 基于图像的照明 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#超采样抗锯齿" class="router-link-active router-link-exact-active sidebar-item" aria-label="超采样抗锯齿"><!--[--><!--]--> 超采样抗锯齿 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#色调映射" class="router-link-active router-link-exact-active sidebar-item" aria-label="色调映射"><!--[--><!--]--> 色调映射 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#伽马矫正" class="router-link-active router-link-exact-active sidebar-item" aria-label="伽马矫正"><!--[--><!--]--> 伽马矫正 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#降噪" class="router-link-active router-link-exact-active sidebar-item" aria-label="降噪"><!--[--><!--]--> 降噪 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#泛光" class="router-link-active router-link-exact-active sidebar-item" aria-label="泛光"><!--[--><!--]--> 泛光 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#研究效果" class="router-link-active router-link-exact-active sidebar-item" aria-label="研究效果"><!--[--><!--]--> 研究效果 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/s/20221231DIP.html#自发光、辉光、镜中镜" class="router-link-active router-link-exact-active sidebar-item" aria-label="自发光、辉光、镜中镜"><!--[--><!--]--> 自发光、辉光、镜中镜 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#玻璃中的空气-空气中的玻璃" class="router-link-active router-link-exact-active sidebar-item" aria-label="玻璃中的空气，空气中的玻璃"><!--[--><!--]--> 玻璃中的空气，空气中的玻璃 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#光圈、景深、对焦测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="光圈、景深、对焦测试"><!--[--><!--]--> 光圈、景深、对焦测试 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#人脸模型、茶壶模型、各种材质" class="router-link-active router-link-exact-active sidebar-item" aria-label="人脸模型、茶壶模型、各种材质"><!--[--><!--]--> 人脸模型、茶壶模型、各种材质 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#自发光绿球、镜子面对面" class="router-link-active router-link-exact-active sidebar-item" aria-label="自发光绿球、镜子面对面"><!--[--><!--]--> 自发光绿球、镜子面对面 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#不足之处" class="router-link-active router-link-exact-active sidebar-item" aria-label="不足之处"><!--[--><!--]--> 不足之处 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/s/20221231DIP.html#todo" class="router-link-active router-link-exact-active sidebar-item" aria-label="ToDo"><!--[--><!--]--> ToDo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#展望" class="router-link-active router-link-exact-active sidebar-item" aria-label="展望"><!--[--><!--]--> 展望 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#致谢" class="router-link-active router-link-exact-active sidebar-item" aria-label="致谢"><!--[--><!--]--> 致谢 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#附录" class="router-link-active router-link-exact-active sidebar-item" aria-label="附录"><!--[--><!--]--> 附录 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="数字图像处理基础大作业" tabindex="-1"><a class="header-anchor" href="#数字图像处理基础大作业" aria-hidden="true">#</a> 数字图像处理基础大作业</h1><div style="text-align:center;"><p><img src="/assets/mim2.e8d8fd9d.jpg" alt="mim2"></p><p>自发光、辉光、镜中镜</p></div><details class="custom-container details"><summary>查看目录</summary><nav class="table-of-contents"><ul><li><a aria-current="page" href="/blog/s/20221231DIP.html#前言" class="router-link-active router-link-exact-active">前言</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#选题" class="router-link-active router-link-exact-active">选题</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#工具" class="router-link-active router-link-exact-active">工具</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#基础原理" class="router-link-active router-link-exact-active">基础原理</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#算法难点" class="router-link-active router-link-exact-active">算法难点</a><ul><li><a aria-current="page" href="/blog/s/20221231DIP.html#光线与物体求交" class="router-link-active router-link-exact-active">光线与物体求交</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#光线与物体材质交互" class="router-link-active router-link-exact-active">光线与物体材质交互</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#双向散射率分布函数" class="router-link-active router-link-exact-active">双向散射率分布函数</a></li></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#摄像机表示" class="router-link-active router-link-exact-active">摄像机表示</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#图像处理" class="router-link-active router-link-exact-active">图像处理</a><ul><li><a aria-current="page" href="/blog/s/20221231DIP.html#基于图像的照明" class="router-link-active router-link-exact-active">基于图像的照明</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#超采样抗锯齿" class="router-link-active router-link-exact-active">超采样抗锯齿</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#色调映射" class="router-link-active router-link-exact-active">色调映射</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#伽马矫正" class="router-link-active router-link-exact-active">伽马矫正</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#降噪" class="router-link-active router-link-exact-active">降噪</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#泛光" class="router-link-active router-link-exact-active">泛光</a></li></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#研究效果" class="router-link-active router-link-exact-active">研究效果</a><ul><li><a aria-current="page" href="/blog/s/20221231DIP.html#自发光、辉光、镜中镜" class="router-link-active router-link-exact-active">自发光、辉光、镜中镜</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#玻璃中的空气-空气中的玻璃" class="router-link-active router-link-exact-active">玻璃中的空气，空气中的玻璃</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#光圈、景深、对焦测试" class="router-link-active router-link-exact-active">光圈、景深、对焦测试</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#人脸模型、茶壶模型、各种材质" class="router-link-active router-link-exact-active">人脸模型、茶壶模型、各种材质</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#自发光绿球、镜子面对面" class="router-link-active router-link-exact-active">自发光绿球、镜子面对面</a></li></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#不足之处" class="router-link-active router-link-exact-active">不足之处</a><ul><li><a aria-current="page" href="/blog/s/20221231DIP.html#todo" class="router-link-active router-link-exact-active">ToDo</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#展望" class="router-link-active router-link-exact-active">展望</a></li></ul></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#致谢" class="router-link-active router-link-exact-active">致谢</a></li><li><a aria-current="page" href="/blog/s/20221231DIP.html#附录" class="router-link-active router-link-exact-active">附录</a></li></ul></nav></details><div style="page-break-after:always;"></div><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>亲爱的 XX 老师，这次大作业我会主要介绍我在这两周自行从零实现的一个 PT Renderer (路径追踪渲染器)，涉及的主要工作是计算机伪随机数生成、三维空间中的变换、蒙特卡洛、图像采样、图像预处理、双向散射分布函数、有向距离场函数和求交、计算成像、基于物理的渲染、基础光学原理、色调映射算法、图像后期降噪算法等。我没有按照老师的要求从作品选题中四选一，但我能保证本文介绍的 PT 是我个人从零开始实现的，本文是本人独创。</p><p>PT 中涉及到了一些简单的数字图像处理操作，此作品的 Taichi 语言 (一个并行计算框架) 版本<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>也获得了太极图形 (<a href="taichi.graphics">Taichi Graphics</a>, 国内一家图形学研究初创公司) 的 Hackathon 比赛第一名。相信我从《数字图像处理处理基础》这门课程中有所收获。</p><h2 id="选题" tabindex="-1"><a class="header-anchor" href="#选题" aria-hidden="true">#</a> 选题</h2><p>正如前面所说，本次大作业我采用自己的选题《一个基于路径追踪并基于物理的有向距离场函数渲染器》，项目采用的是 Taichi 和着色器语言 (SL) 描述，并实时通过像素着色器运行在图形处理器中。<s>对于老师给的四个选题，其中选题一我会采用计算着色器对图像做预处理，使用卷积寻找瓶子边缘和瓶颈并分割，用灰度值面积比的阈值就可以大致判断出是否装满。对于第二题可以是用灰度化、二值化、降噪、腐蚀算法。第三题可以用灰度化、二值化、矫正扭曲、去噪、识别。第四题我可能会用卷积神经网络。</s></p><h2 id="工具" tabindex="-1"><a class="header-anchor" href="#工具" aria-hidden="true">#</a> 工具</h2><p>着色器程序使用着色器语言编写的，并由 CPU 编译为机器码，发送到 GPU 中由 GPU 直接并行运行的程序。因此它的并行处理效率极其优秀。着色器程序分为很多种，例如顶点着色器、片段着色器、几何着色器、计算着色器等等。GPU 尤其擅长高密度的并行运算，并对向量、矩阵和线性代数常见运算有着特别指令优化。上面这些优点 Taichi 编程语言也有，Taichi 可以被嵌入到 Python 中。因此本项目采用 Taichi 和 SL 编写。</p><h2 id="基础原理" tabindex="-1"><a class="header-anchor" href="#基础原理" aria-hidden="true">#</a> 基础原理</h2><p>光线追踪程序的基本原理是从光源发出光子，光子传播并与物体表面或次表面产生作用，然后继续传播，直到击中摄像机的传感器。然鹅由于对光源的采样，太少密度光子会击中传感器了，为了提高计算效率，假设光子沿着直线传播，并且按照光路可逆原理，光线从屏幕像素逆向寻找光源，大大提高了计算效率，因此这种方法被称作反向路径追踪。</p><p>路径追踪的好处是每个像素都能够无偏的获得整个虚拟世界中的信息，因此可以带来全局光照效果，而基于 PBR 的渲染又可以达到真实感渲染器需求。但路径追踪的缺点是相比光栅化和屏幕空间的渲染，计算量大幅度上升，因此难以做到实时渲染（每秒 24 帧以上并保证像素采样质量），大多应用在高级的离线渲染器。</p><p>本文采用的渲染算法为反向路径追踪，简图如下：</p><div class="mermaid-wrapper loading"><svg xmlns="http://www.w3.org/2000/svg" class="icon loading-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="loading icon"><circle cx="512" cy="512" r="0" fill="none" stroke="currentColor" stroke-width="20"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;400" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate></circle><circle cx="512" cy="512" r="0" fill="none" stroke="currentColor" stroke-width="20"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;400" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.333s"></animate><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.333s"></animate></circle><circle cx="512" cy="512" r="0" fill="none" stroke="currentColor" stroke-width="20"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;400" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.667s"></animate><animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.667s"></animate></circle></svg></div><h2 id="算法难点" tabindex="-1"><a class="header-anchor" href="#算法难点" aria-hidden="true">#</a> 算法难点</h2><p>一个路径追踪渲染器的难点和计算密集度主要集中在两点，分别是:</p><ul><li>光线与物体求交</li><li>光线与物体材质交互</li></ul><h3 id="光线与物体求交" tabindex="-1"><a class="header-anchor" href="#光线与物体求交" aria-hidden="true">#</a> 光线与物体求交</h3><p>光线与物体求交指的是，光线（包含当前位置和方向）传播后:</p><ul><li>与哪个物体相交？在哪里相交？</li><li>相交位置物体表面的法线是什么？</li><li>相交位置的材质信息是什么？</li></ul><h4 id="形状建模" tabindex="-1"><a class="header-anchor" href="#形状建模" aria-hidden="true">#</a> 形状建模</h4><p>这涉及到我们如何表示对物体建模。物体包含了形状、变换（包含位置、旋转、大小），对物体形状的建模方式通常有三种：</p><ul><li>网格（离散，不统一） <ul><li>网格 (Mesh) ，用离散的顶点组成的不统一三角面表示物体形状</li></ul></li><li>体素（离散，统一） <ul><li>体素 (Voxel)，用离散但是大小统一的方块来组成物体形状</li></ul></li><li>场（连续，统一） <ul><li>场 (Field) ，用连续的数学函数表示物体形状，通常有距离场、密度场等</li></ul></li></ul><p>本研究采用有向距离场 (SDF, Signed Distance Field) 表示物体，当距离为 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> 时代表点在物体表面，因此方程 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.566ex;" xmlns="http://www.w3.org/2000/svg" width="10.836ex" height="2.495ex" role="img" focusable="false" viewBox="0 -853 4789.6 1103"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(989,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1539,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1928,0)"><g data-mml-node="mover"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D429" d="M32 442L123 446Q214 450 215 450H221V409Q222 409 229 413T251 423T284 436T328 446T382 450Q480 450 540 388T600 223Q600 128 539 61T361 -6H354Q292 -6 236 28L227 34V-132H296V-194H287Q269 -191 163 -191Q56 -191 38 -194H29V-132H98V113V284Q98 330 97 348T93 370T83 376Q69 380 42 380H29V442H32ZM457 224Q457 303 427 349T350 395Q282 395 235 352L227 345V104L233 97Q274 45 337 45Q383 45 420 86T457 224Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(319.5,39) translate(-250 0)"><path data-c="20D7" d="M377 694Q377 702 382 708T397 714Q404 714 409 709Q414 705 419 690Q429 653 460 633Q471 626 471 615Q471 606 468 603T454 594Q411 572 379 531Q377 529 374 525T369 519T364 517T357 516Q350 516 344 521T337 536Q337 555 384 595H213L42 596Q29 605 29 615Q29 622 42 635H401Q377 673 377 694Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(2567,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3233.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(4289.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> 表示的是一个隐式曲面，且通过简单的数学操作可以对场进行交、并、差集来建模。</p><div style="text-align:center;"><table><thead><tr><th style="text-align:center;"><img src="/assets/gfx16.7060ca57.png" alt=""></th><th style="text-align:center;"><img src="/assets/gfx18.83d2a12b.png" alt=""></th><th style="text-align:center;"><img src="/assets/gfx45.a1efeea4.png" alt=""></th></tr></thead><tbody><tr><td style="text-align:center;">扭曲物体</td><td style="text-align:center;">重复物体</td><td style="text-align:center;">并集、差集、交集</td></tr></tbody></table><p>图片来自 <a href="https://iquilezles.org/articles/distfunctions/" target="_blank" rel="noopener noreferrer">https://iquilezles.org/articles/distfunctions/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></div><h4 id="步进求交" tabindex="-1"><a class="header-anchor" href="#步进求交" aria-hidden="true">#</a> 步进求交</h4><p>有了形状之后，对物体的求交就变成了数学问题。对于 SDF 形状，采用的办法是光线步进 (Ray March) 方法——球体追踪 (Sphere Tracing) 。即让光子一步一步前进，且前进距离为离最近表面的距离（距离场函数表示的就是离表面的最近距离），如果光子离物体表面足够近就认为相交。</p><div style="text-align:center;"><table><thead><tr><th style="text-align:center;"><img src="/assets/08.a6084bf8.png" alt=""></th><th style="text-align:center;"><img src="/assets/09.b0d09468.png" alt=""></th></tr></thead><tbody><tr><td style="text-align:center;">较好的情况下很快到达物体表面</td><td style="text-align:center;">没有交点的情况很快就发散</td></tr></tbody></table><p>图片截取自 <a href="https://www.shadertoy.com/view/lslXD8" target="_blank" rel="noopener noreferrer">https://www.shadertoy.com/view/lslXD8<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p></div><h4 id="核心代码" tabindex="-1"><a class="header-anchor" href="#核心代码" aria-hidden="true">#</a> 核心代码</h4><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token comment">// 使用光线步进 (Ray March) 检测第一个交点</span>
record <span class="token function">raycast</span><span class="token punctuation">(</span>ray r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    record rec<span class="token punctuation">;</span> <span class="token keyword">float</span> t <span class="token operator">=</span> TMIN<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">uint</span> i <span class="token operator">=</span> <span class="token number">0U</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX_RAYMARCH <span class="token operator">&amp;&amp;</span> t <span class="token operator">&lt;</span> TMAX <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rec<span class="token punctuation">.</span>hit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rec<span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token function">at</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rec<span class="token punctuation">.</span>obj <span class="token operator">=</span> <span class="token function">nearest_object</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rec<span class="token punctuation">.</span>hit <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>dis <span class="token operator">&lt;</span> PRECISION<span class="token punctuation">;</span>
        t      <span class="token operator">+=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>dis<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> rec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="光线与物体材质交互" tabindex="-1"><a class="header-anchor" href="#光线与物体材质交互" aria-hidden="true">#</a> 光线与物体材质交互</h3><p>光线与物体材质交互指的是，当光线达到物体表面之后，哪些光会被吸收？哪些光会被反射、散射、折射？并且方向是什么？或者更简单的说就是，光子颜色和方向怎么变化？本研究采用的是基于物理的渲染 (PBR, Physicallly-Based Rendering) ，且采用“粗糙度/金属度”表示方法。</p><p>由于一条光线经过材质交互后可能产生的不止一条光线，我们把一次交互认为是材质在这一点上的球面采样。这样的话光线在多次在物体表面采样后可能会像“核裂变”一样产生巨量的光线，计算量过高，通常我们也不希望使用递归的方法。有一种办法避开“核裂变”，每一次只采样一条光线，把计算量分摊到更多帧，然后再累积起来。那就是使用蒙特卡洛采样，或者低差异化序列采样。本研究目前采用蒙特卡洛采样。</p><h3 id="双向散射率分布函数" tabindex="-1"><a class="header-anchor" href="#双向散射率分布函数" aria-hidden="true">#</a> 双向散射率分布函数</h3><p>本研究的 PBR 基于双向散射率分布函数 (BSDF, Bidirectional Scattering Distribution Function) ，包含反射散射部分 (RSDF) 和透射散射部分 (TSDF) 。对于使用这种方法渲染，已经能够达到真实感渲染器需求。</p><p>对物体材质的建模包含当前位置的粗糙度、金属度、基础色、透射度、折射率等。有时还会加入法线映射、置换映射、环境光遮蔽映射，目的是以以低精度模型为物体表面带来不同的法线、高度和遮蔽信息。</p><h4 id="核心代码-1" tabindex="-1"><a class="header-anchor" href="#核心代码-1" aria-hidden="true">#</a> 核心代码</h4><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token comment">// 应用 PBR 材质</span>
ray <span class="token function">BSDF</span><span class="token punctuation">(</span>ray r<span class="token punctuation">,</span> record rec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 材质参数</span>
    <span class="token keyword">vec3</span>  albedo       <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>albedo<span class="token punctuation">;</span>
    <span class="token keyword">float</span> roughness    <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>roughness<span class="token punctuation">;</span>
    <span class="token keyword">float</span> metallic     <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>metallic<span class="token punctuation">;</span>
    <span class="token keyword">float</span> transmission <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>transmission<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span>  normal       <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>normal<span class="token punctuation">;</span>
    <span class="token keyword">float</span> ior          <span class="token operator">=</span> rec<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>mtl<span class="token punctuation">.</span>ior<span class="token punctuation">;</span>
    
    normal <span class="token operator">=</span> <span class="token function">TBN</span><span class="token punctuation">(</span>rec<span class="token punctuation">.</span>normal<span class="token punctuation">)</span> <span class="token operator">*</span> normal<span class="token punctuation">;</span> <span class="token comment">// 将切线空间法线转换到世界空间</span>
    <span class="token keyword">float</span> outer <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span> r<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 光正在从外面穿入物体表面</span>
    
    <span class="token comment">// 光线和物体表面参数</span>
    <span class="token keyword">vec3</span> I  <span class="token operator">=</span>  r<span class="token punctuation">.</span>direction<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> V  <span class="token operator">=</span> <span class="token operator">-</span>r<span class="token punctuation">.</span>direction<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> N  <span class="token operator">=</span>  normal <span class="token operator">*=</span> outer<span class="token punctuation">;</span> <span class="token comment">// 如果处于 SDF 物体内部就反过来</span>
    <span class="token keyword">vec3</span> C  <span class="token operator">=</span>  r<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> L<span class="token punctuation">;</span>
    
    N <span class="token operator">=</span> <span class="token function">TBN</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">hemispheric_sampling</span><span class="token punctuation">(</span>roughness<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用粗糙度半球采样</span>
    <span class="token keyword">float</span> NoV <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> eta <span class="token operator">=</span> outer <span class="token operator">&gt;</span> <span class="token number">0.0</span> <span class="token operator">?</span> ENV_IOR <span class="token operator">/</span> ior <span class="token operator">:</span> ior <span class="token operator">/</span> ENV_IOR<span class="token punctuation">;</span> <span class="token comment">// 计算折射率之比</span>
    <span class="token keyword">float</span> k   <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">-</span> eta <span class="token operator">*</span> eta <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> NoV <span class="token operator">*</span> NoV<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 小于 0 为全反射</span>
    <span class="token keyword">float</span> F0  <span class="token operator">=</span> <span class="token punctuation">(</span>eta <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>eta <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> F0 <span class="token operator">*=</span> <span class="token number">3.0</span><span class="token operator">*</span>F0<span class="token punctuation">;</span> <span class="token comment">// 让反射更明显一些</span>
    <span class="token keyword">float</span> F   <span class="token operator">=</span> <span class="token function">fresnel_schlick</span><span class="token punctuation">(</span>NoV<span class="token punctuation">,</span> F0<span class="token punctuation">,</span> roughness<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 菲涅尔</span>

    <span class="token keyword">vec2</span> rand2 <span class="token operator">=</span> <span class="token function">rand21</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取两个随机数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rand2<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> F <span class="token operator">+</span> metallic <span class="token operator">||</span> k <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            L <span class="token operator">=</span> I <span class="token operator">+</span> <span class="token number">2.0</span> <span class="token operator">*</span> NoV <span class="token operator">*</span> N<span class="token punctuation">;</span> <span class="token comment">// 包含镜面反射、菲涅尔反射、全反射</span>
            <span class="token comment">// 下面可以提高帧数，但是会导致透明材质发黑，需要优化</span>
            C <span class="token operator">*=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> normal<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果光穿入或穿出表面就直接吸收掉 </span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rand2<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> transmission<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            L <span class="token operator">=</span> eta <span class="token operator">*</span> I <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">-</span> eta <span class="token operator">*</span> NoV<span class="token punctuation">)</span> <span class="token operator">*</span> N<span class="token punctuation">;</span> <span class="token comment">// 斯涅尔折射</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            L <span class="token operator">=</span> <span class="token function">TBN</span><span class="token punctuation">(</span>normal<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">hemispheric_sampling</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 漫反射</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    C <span class="token operator">*=</span> albedo<span class="token punctuation">;</span>

    <span class="token comment">// 更新光的方向和颜色</span>
    r<span class="token punctuation">.</span>color     <span class="token operator">=</span> C<span class="token punctuation">;</span>
    r<span class="token punctuation">.</span>direction <span class="token operator">=</span> L<span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="摄像机表示" tabindex="-1"><a class="header-anchor" href="#摄像机表示" aria-hidden="true">#</a> 摄像机表示</h2><p>摄像机是对人眼的模仿，但现实的摄像机拥有更多可以调整的参数，例如除了有位置 (lookfrom) 、朝向 (lookat, vup) 之外，还有视野 (vfov)、传感器（画布）长宽比 (aspect)、光圈直径 (aperture)、合焦距离 (focus) 等等参数，这些参数会影响摄像机传感器捕获的光子。关于摄像机的更多信息，可以看我为 Taichi 写的这篇科普文章：<a href="https://shao.fun/blog/w/taichi-ray-tracing.html#%E5%88%9B%E5%BB%BA%E6%91%84%E5%83%8F%E6%9C%BA%E7%B1%BB" target="_blank" rel="noopener noreferrer">Taichi: 从零开始的光线追踪 | HK-SHAO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><div style="text-align:center;"><p><img src="/assets/12.1c9df3b9.svg" alt=""><br> 我为这个摄像机模型总结了一幅图，根据这幅图可以直观的写出代码</p></div><h2 id="图像处理" tabindex="-1"><a class="header-anchor" href="#图像处理" aria-hidden="true">#</a> 图像处理</h2><p>像素着色器程序就是对输入像素和信息进行处理然后输出像素信息 (一个 <code>vec4</code> 分别表示 RGBA 四个通道的强度，归一化到 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1722.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> 之间) 。</p><p>本研究的图像处理集中在基于图像的照明 (IBL, Image Based Lighting) 、色调映射 (Tone Mapping) 和图像降噪。</p><h3 id="基于图像的照明" tabindex="-1"><a class="header-anchor" href="#基于图像的照明" aria-hidden="true">#</a> 基于图像的照明</h3><p>通常是在现实世界用相机采集整个环境的高动态范围 (HDR) 图像，然后投影到天空盒（六个正方形图像）或者从一个球等距投影到展开的圆柱体上（一个矩形图像）。这样，这张图像就可以充当环境光照信息，对虚拟世界里的物体打光。如下图，是等距投影的一张 HDR 图像（已被转换到 SDR/sRGB ）</p><div style="text-align:center;"><p><img src="/assets/Tokyo_BigSight_3k.4947cbbd.jpg" alt=""></p><p>东京国际展览中心的 IBL 图片<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></p></div><p>对于反向路径追踪，基于图像的照明很简单。当光线没有与任何一个物体相交时，光线会在无穷远处与天空相交，而这个天空就是我们的 HDR 图像，这样就做到在 HDR 上采样 IBL 了。</p><h4 id="核心代码-2" tabindex="-1"><a class="header-anchor" href="#核心代码-2" aria-hidden="true">#</a> 核心代码</h4><p>由于某些情况下无法使用 HDR 图像，因此下面的方法是将一张 SDR 图像叠加一张泛光后的 SDR 图像来模拟 HDR 图像。</p><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token comment">// 采样立方体贴图</span>
<span class="token keyword">vec4</span> <span class="token function">mix_cube_lod</span><span class="token punctuation">(</span><span class="token keyword">samplerCube</span> sharp<span class="token punctuation">,</span> 
                  <span class="token keyword">samplerCube</span> blur<span class="token punctuation">,</span> <span class="token keyword">vec3</span> dir<span class="token punctuation">,</span> <span class="token keyword">float</span> lod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token function">textureLod</span><span class="token punctuation">(</span>sharp<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> lod<span class="token punctuation">)</span><span class="token punctuation">,</span> 
               <span class="token function">textureLod</span><span class="token punctuation">(</span>blur<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> lod<span class="token punctuation">)</span><span class="token punctuation">,</span> lod<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 采样天空</span>
<span class="token keyword">vec3</span> <span class="token function">sky</span><span class="token punctuation">(</span>ray r<span class="token punctuation">,</span> <span class="token keyword">float</span> brightness<span class="token punctuation">,</span> <span class="token keyword">float</span> lod<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 天空盒 IBL 照明</span>
    <span class="token keyword">vec4</span> ibl <span class="token operator">=</span> <span class="token function">mix_cube_lod</span><span class="token punctuation">(</span>iChannel2<span class="token punctuation">,</span> iChannel3<span class="token punctuation">,</span> r<span class="token punctuation">.</span>direction<span class="token punctuation">,</span> lod<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token function">pow</span><span class="token punctuation">(</span>ibl<span class="token punctuation">.</span>rgb <span class="token operator">*</span> ibl<span class="token punctuation">.</span>a <span class="token operator">*</span> brightness<span class="token punctuation">,</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>gamma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// gamma 矫正</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="超采样抗锯齿" tabindex="-1"><a class="header-anchor" href="#超采样抗锯齿" aria-hidden="true">#</a> 超采样抗锯齿</h3><p>锯齿的产生是因为我们的像素是离散的，但是只要像素密度足够高，我们就难以察觉出锯齿。因此超采样抗锯齿的思路是在一个像素中虚拟出更多像素，然后对这些像素进行平均。在光线追踪中，我们可以在一个像素中对 uv 进行抖动，来模拟对像素内大量虚拟像素的采样。</p><p>在蒙特卡洛过程使用超采样抗锯齿的办法很简单，只需要对 UV 进行抖动即可。</p><h4 id="核心代码-3" tabindex="-1"><a class="header-anchor" href="#核心代码-3" aria-hidden="true">#</a> 核心代码</h4><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token comment">// 用 UV 和时间初始化随机数发生器种子</span>
seed <span class="token operator">=</span> <span class="token function">rand13</span><span class="token punctuation">(</span><span class="token keyword">vec3</span><span class="token punctuation">(</span>uv<span class="token punctuation">,</span> TIME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 超采样</span>
uv <span class="token operator">+=</span> <span class="token function">rand21</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> SCREEN_PIXEL_SIZE<span class="token punctuation">;</span>

<span class="token comment">// 对每个光子经过的表面采样一次</span>
ray r <span class="token operator">=</span> <span class="token function">get_ray</span><span class="token punctuation">(</span>cam<span class="token punctuation">,</span> uv<span class="token punctuation">,</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 处理颜色</span>
<span class="token keyword">vec3</span> color <span class="token operator">=</span> <span class="token function">raytrace</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="色调映射" tabindex="-1"><a class="header-anchor" href="#色调映射" aria-hidden="true">#</a> 色调映射</h3><p>大多数显示器能够显示的色彩范围是 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2000.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1222.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1722.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> ，当 RGB 的某个分量大于 1 时，会被直接截断为 1 ，这带来的后果是大量高光信息丢失。自然世界中的光强取值是 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.566ex;" xmlns="http://www.w3.org/2000/svg" width="7.418ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3278.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(278,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(778,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1222.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(2000.7,0)"><path data-c="221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3000.7,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> ，为了能够让更广的动态范围被显示设备显示，需要一条曲线映射原本的光强，在保证阴影和高光细节的同时，呈现更真实的色彩。</p><div style="text-align:center;"><table><thead><tr><th style="text-align:center;"><img src="/assets/clamp.989b9842.png" alt=""></th><th style="text-align:center;"><img src="/assets/aces.23447be7.png" alt=""></th></tr></thead><tbody><tr><td style="text-align:center;">直接截断颜色</td><td style="text-align:center;">ACES 色调映射</td></tr></tbody></table></div><p>Matt Taylor 的这篇文章<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup>很好的总结了各种色调映射算法，本研究使用了 ACES (Academy Color Encoding System) 色调映射算法。</p><h4 id="核心代码-4" tabindex="-1"><a class="header-anchor" href="#核心代码-4" aria-hidden="true">#</a> 核心代码</h4><p>非本次研究独创，代码来自 Paniq&#39;s ACES fitted from <a href="https://github.com/TheRealMJP/BakingLab/blob/master/BakingLab/ACES.hlsl" target="_blank" rel="noopener noreferrer">https://github.com/TheRealMJP/BakingLab/blob/master/BakingLab/ACES.hlsl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token keyword">vec3</span> <span class="token function">ACESFitted</span><span class="token punctuation">(</span><span class="token keyword">vec3</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ODT_SAT =&gt; XYZ =&gt; D60_2_D65 =&gt; sRGB</span>
    color <span class="token operator">*=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>
        <span class="token number">0.59719</span><span class="token punctuation">,</span> <span class="token number">0.35458</span><span class="token punctuation">,</span> <span class="token number">0.04823</span><span class="token punctuation">,</span>
        <span class="token number">0.07600</span><span class="token punctuation">,</span> <span class="token number">0.90834</span><span class="token punctuation">,</span> <span class="token number">0.01566</span><span class="token punctuation">,</span>
        <span class="token number">0.02840</span><span class="token punctuation">,</span> <span class="token number">0.13383</span><span class="token punctuation">,</span> <span class="token number">0.83777</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Apply RRT and ODT</span>
    <span class="token keyword">vec3</span> a <span class="token operator">=</span> color <span class="token operator">*</span> <span class="token punctuation">(</span>color <span class="token operator">+</span> <span class="token number">0.0245786</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.000090537</span><span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> b <span class="token operator">=</span> color <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.983729</span> <span class="token operator">*</span> color <span class="token operator">+</span> <span class="token number">0.4329510</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.238081</span><span class="token punctuation">;</span>
    color  <span class="token operator">=</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
	<span class="token comment">// Back to color space</span>
    color <span class="token operator">*=</span> <span class="token keyword">mat3</span><span class="token punctuation">(</span>
         <span class="token number">1.60475</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.53108</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.07367</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.10208</span><span class="token punctuation">,</span>  <span class="token number">1.10813</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.00605</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.00327</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.07276</span><span class="token punctuation">,</span>  <span class="token number">1.07602</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Clamp to [0, 1]</span>
    <span class="token keyword">return</span> <span class="token function">clamp</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="伽马矫正" tabindex="-1"><a class="header-anchor" href="#伽马矫正" aria-hidden="true">#</a> 伽马矫正</h3><p>在图像后处理阶段，色调映射前应该调整曝光值，色调映射后要对图像进行 gamma 映射。人眼感受到的光强并不是与物理世界的光强成线性增长，因此色调映射通常与 gamma 矫正一起使用。</p><h4 id="核心代码-5" tabindex="-1"><a class="header-anchor" href="#核心代码-5" aria-hidden="true">#</a> 核心代码</h4><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token comment">// 色调映射</span>
color <span class="token operator">*=</span> camera_exposure<span class="token punctuation">;</span>
color  <span class="token operator">=</span> <span class="token function">ACESFitted</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 伽马矫正</span>
color <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">/</span> gamma<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="降噪" tabindex="-1"><a class="header-anchor" href="#降噪" aria-hidden="true">#</a> 降噪</h3><p>由蒙特卡洛采样路径追踪产生的图像，通常包含大量噪点。研究需要一种方法，能在各个处理阶段尽量减少噪点。通常降噪可以从这三方面优化：</p><ul><li>蒙特卡洛重要性采样：尽量采样更多贡献更大的光线路径</li><li>增加采样次数 (SPP, Samples per pixel) ：为每一像素采样更多次颜色信息并混合起来</li><li>后处理降噪：通用图像降噪后处理方法或者针对路径追踪程序的特定图像降噪后处理</li></ul><h4 id="重要性采样" tabindex="-1"><a class="header-anchor" href="#重要性采样" aria-hidden="true">#</a> 重要性采样</h4><p>本研究没有使用特定的重要性采样算法，而是直接根据模型对光的方向进行改变。在本文截止之前，我还未实现对光源的重要性采样（本来今天正准备研究的，但是得等我写完这篇报告先）。</p><p>对光源的重要性采样集中在寻找场景中光源位置和光源类型，光源类型包括点光源、面光源、方向光源、体积光源等。基本思路是根据光源信息来决定采样的偏向。</p><h4 id="增加采样数" tabindex="-1"><a class="header-anchor" href="#增加采样数" aria-hidden="true">#</a> 增加采样数</h4><p>基础降噪的思路很简单，因为光线追踪是一个蒙特卡洛过程，所以我们可以在迭代中对多帧结果进行积累，当积累足够多步数后，总有一个临界点让我们无法观察到噪点。我们可以用变量 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.62ex" height="1.934ex" role="img" focusable="false" viewBox="0 -697 1158 854.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D402" d="M64 343Q64 502 174 599T468 697Q502 697 533 691T586 674T623 655T647 639T657 632L694 663Q703 670 711 677T723 687T730 692T735 695T740 696T746 697Q759 697 762 692T766 668V627V489V449Q766 428 762 424T742 419H732H720Q699 419 697 436Q690 498 657 545Q611 618 532 632Q522 634 496 634Q356 634 286 553Q232 488 232 343T286 133Q355 52 497 52Q597 52 650 112T704 237Q704 248 709 251T729 254H735Q750 254 755 253T763 248T766 234Q766 136 680 63T469 -11Q285 -11 175 86T64 343Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mi" transform="translate(864,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></g></svg></mjx-container> 和 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.471ex;" xmlns="http://www.w3.org/2000/svg" width="4.664ex" height="2.047ex" role="img" focusable="false" viewBox="0 -697 2061.6 905"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D402" d="M64 343Q64 502 174 599T468 697Q502 697 533 691T586 674T623 655T647 639T657 632L694 663Q703 670 711 677T723 687T730 692T735 695T740 696T746 697Q759 697 762 692T766 668V627V489V449Q766 428 762 424T742 419H732H720Q699 419 697 436Q690 498 657 545Q611 618 532 632Q522 634 496 634Q356 634 286 553Q232 488 232 343T286 133Q355 52 497 52Q597 52 650 112T704 237Q704 248 709 251T729 254H735Q750 254 755 253T763 248T766 234Q766 136 680 63T469 -11Q285 -11 175 86T64 343Z" style="stroke-width:3;"></path></g></g><g data-mml-node="TeXAtom" transform="translate(864,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g></g></g></g></svg></mjx-container> 来表示当前帧和上一帧像素颜色，用 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.185ex" height="1.934ex" role="img" focusable="false" viewBox="0 -697 966 854.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D412" d="M64 493Q64 582 120 636T264 696H272Q280 697 285 697Q380 697 454 645L480 669Q484 672 488 676T495 683T500 688T504 691T508 693T511 695T514 696T517 697T522 697Q536 697 539 691T542 652V577Q542 557 542 532T543 500Q543 472 540 465T524 458H511H505Q489 458 485 461T479 478Q472 529 449 564T393 614T336 634T287 639Q228 639 203 610T177 544Q177 517 195 493T247 457Q253 454 343 436T475 391Q574 326 574 207V200Q574 163 559 120Q517 12 389 -9Q380 -10 346 -10Q308 -10 275 -5T221 7T184 22T160 35T151 40L126 17Q122 14 118 10T111 3T106 -2T102 -5T98 -7T95 -9T92 -10T89 -11T84 -11Q70 -11 67 -4T64 35V108Q64 128 64 153T63 185Q63 203 63 211T69 223T77 227T94 228H100Q118 228 122 225T126 205Q130 125 193 88T345 51Q408 51 434 82T460 157Q460 196 439 221T388 257Q384 259 305 276T221 295Q155 313 110 366T64 493Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mi" transform="translate(672,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></g></svg></mjx-container> 表示这帧采样到的颜色，用 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 600 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> 来表示当前的采样次数，那么我们可以用下面的公式来更新像素颜色</p><mjx-container class="MathJax" jax="SVG" display="true" style="direction:ltr;display:block;text-align:center;margin:1em 0;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-2.148ex;" xmlns="http://www.w3.org/2000/svg" width="24.267ex" height="5.428ex" role="img" focusable="false" viewBox="0 -1449.5 10726.1 2399"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D402" d="M64 343Q64 502 174 599T468 697Q502 697 533 691T586 674T623 655T647 639T657 632L694 663Q703 670 711 677T723 687T730 692T735 695T740 696T746 697Q759 697 762 692T766 668V627V489V449Q766 428 762 424T742 419H732H720Q699 419 697 436Q690 498 657 545Q611 618 532 632Q522 634 496 634Q356 634 286 553Q232 488 232 343T286 133Q355 52 497 52Q597 52 650 112T704 237Q704 248 709 251T729 254H735Q750 254 755 253T763 248T766 234Q766 136 680 63T469 -11Q285 -11 175 86T64 343Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mi" transform="translate(864,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(1435.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2491.5,0)"><g data-mml-node="mi"><path data-c="6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" style="stroke-width:3;"></path><path data-c="69" d="M69 609Q69 637 87 653T131 669Q154 667 171 652T188 609Q188 579 171 564T129 549Q104 549 87 564T69 609ZM247 0Q232 3 143 3Q132 3 106 3T56 1L34 0H26V46H42Q70 46 91 49Q100 53 102 60T104 102V205V293Q104 345 102 359T88 378Q74 385 41 385H30V408Q30 431 32 431L42 432Q52 433 70 434T106 436Q123 437 142 438T171 441T182 442H185V62Q190 52 197 50T232 46H255V0H247Z" transform="translate(833,0)" style="stroke-width:3;"></path><path data-c="78" d="M201 0Q189 3 102 3Q26 3 17 0H11V46H25Q48 47 67 52T96 61T121 78T139 96T160 122T180 150L226 210L168 288Q159 301 149 315T133 336T122 351T113 363T107 370T100 376T94 379T88 381T80 383Q74 383 44 385H16V431H23Q59 429 126 429Q219 429 229 431H237V385Q201 381 201 369Q201 367 211 353T239 315T268 274L272 270L297 304Q329 345 329 358Q329 364 327 369T322 376T317 380T310 384L307 385H302V431H309Q324 428 408 428Q487 428 493 431H499V385H492Q443 385 411 368Q394 360 377 341T312 257L296 236L358 151Q424 61 429 57T446 50Q464 46 499 46H516V0H510H502Q494 1 482 1T457 2T432 2T414 3Q403 3 377 3T327 1L304 0H295V46H298Q309 46 320 51T331 63Q331 65 291 120L250 175Q249 174 219 133T185 88Q181 83 181 74Q181 63 188 55T206 46Q208 46 208 23V0H201Z" transform="translate(1111,0)" style="stroke-width:3;"></path></g></g><g data-mml-node="mrow" transform="translate(4297.2,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z" style="stroke-width:3;"></path></g><g data-mml-node="msub" transform="translate(736,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D402" d="M64 343Q64 502 174 599T468 697Q502 697 533 691T586 674T623 655T647 639T657 632L694 663Q703 670 711 677T723 687T730 692T735 695T740 696T746 697Q759 697 762 692T766 668V627V489V449Q766 428 762 424T742 419H732H720Q699 419 697 436Q690 498 657 545Q611 618 532 632Q522 634 496 634Q356 634 286 553Q232 488 232 343T286 133Q355 52 497 52Q597 52 650 112T704 237Q704 248 709 251T729 254H735Q750 254 755 253T763 248T766 234Q766 136 680 63T469 -11Q285 -11 175 86T64 343Z" style="stroke-width:3;"></path></g></g><g data-mml-node="TeXAtom" transform="translate(864,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(2797.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="msub" transform="translate(3242.3,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D412" d="M64 493Q64 582 120 636T264 696H272Q280 697 285 697Q380 697 454 645L480 669Q484 672 488 676T495 683T500 688T504 691T508 693T511 695T514 696T517 697T522 697Q536 697 539 691T542 652V577Q542 557 542 532T543 500Q543 472 540 465T524 458H511H505Q489 458 485 461T479 478Q472 529 449 564T393 614T336 634T287 639Q228 639 203 610T177 544Q177 517 195 493T247 457Q253 454 343 436T475 391Q574 326 574 207V200Q574 163 559 120Q517 12 389 -9Q380 -10 346 -10Q308 -10 275 -5T221 7T184 22T160 35T151 40L126 17Q122 14 118 10T111 3T106 -2T102 -5T98 -7T95 -9T92 -10T89 -11T84 -11Q70 -11 67 -4T64 35V108Q64 128 64 153T63 185Q63 203 63 211T69 223T77 227T94 228H100Q118 228 122 225T126 205Q130 125 193 88T345 51Q408 51 434 82T460 157Q460 196 439 221T388 257Q384 259 305 276T221 295Q155 313 110 366T64 493Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mi" transform="translate(672,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g><g data-mml-node="mo" transform="translate(4208.3,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(4652.9,0)"><g data-mml-node="mn" transform="translate(270,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(220,-686)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><rect width="800" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5692.9,0) translate(0 -0.5)"><path data-c="29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z" style="stroke-width:3;"></path></g></g></g></g></svg></mjx-container><p>还有一种方法是直接将颜色累加起来，使用 alpha 通道，也就是像素 <code>vec4</code> 的 alpha 值来标记这个像素采样的次数，在下一个 buffer 中将颜色值除以 alpha 值获取平均后的颜色。</p><h4 id="人工智能降噪" tabindex="-1"><a class="header-anchor" href="#人工智能降噪" aria-hidden="true">#</a> 人工智能降噪</h4><p>针对路径追踪的 AI 降噪是一项很重要的研究，这项研究英伟达、英特尔等企业都在研究并在 SIGGRAPH 发了数篇论文，其中目前最新的一篇是英特尔的。</p><p>Intel 的论文 <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/temporally-stable-denoising-and-supersampling.html" target="_blank" rel="noopener noreferrer">Temporally Stable Real-Time Joint Neural Denoising and Supersampling<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a> 提出了一种效果不错的光追降噪方法，这是一种混合了传统和 AI 的降噪方案 。</p><p>我与 Keyu Lu (宾夕法尼亚大学图形学在读学生) 同学正在共同研究这篇论文，Keyu Lu 写了篇简介在我的博客<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup>，更多信息请前往这里查看：<a href="https://shao.fun/blog/w/ray-tracing-denoise.html" target="_blank" rel="noopener noreferrer">光线追踪实时渲染降噪 (WIP) | HK-SHAO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><h3 id="泛光" tabindex="-1"><a class="header-anchor" href="#泛光" aria-hidden="true">#</a> 泛光</h3><p>由于我们的显示器通常都是 SDR 而不是 HDR，更高的亮度信息会被直接截断到 <mjx-container class="MathJax" jax="SVG" style="direction:ltr;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g></g></g></svg></mjx-container> ，没办法显示亮度特别高的画面，因此有一种图像后处理技术，提取原本更高亮度的信息，然后采用一个高斯模糊或者其它泛光图形映射得到一张图像与原本的图像叠加起来。这样就获得了好看的泛光效果，让人视觉上感受这块区域亮度很高。</p><h4 id="后处理代码" tabindex="-1"><a class="header-anchor" href="#后处理代码" aria-hidden="true">#</a> 后处理代码</h4><p>非此次研究原创，代码 fork 自 <a href="https://www.shadertoy.com/view/MssczX" target="_blank" rel="noopener noreferrer">Gem Bloom FX (shadertoy.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></p><div class="language-glsl line-numbers-mode" data-ext="glsl"><pre class="language-glsl"><code><span class="token keyword">vec2</span> <span class="token function">rot</span><span class="token punctuation">(</span><span class="token keyword">vec2</span> p<span class="token punctuation">,</span> <span class="token keyword">float</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a<span class="token operator">=</span><span class="token function">radians</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">cos</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">*</span>p <span class="token operator">+</span> <span class="token function">sin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">*</span><span class="token keyword">vec2</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>p<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">vec2</span> <span class="token function">saturate</span><span class="token punctuation">(</span><span class="token keyword">vec2</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">clamp</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">mainImage</span><span class="token punctuation">(</span> <span class="token keyword">out</span> <span class="token keyword">vec4</span> fragColor<span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token keyword">vec2</span> fragCoord <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> n <span class="token operator">=</span> <span class="token number">24.</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> a1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> a2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5.</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> uv <span class="token operator">=</span> fragCoord<span class="token operator">/</span>iResolution<span class="token punctuation">.</span>xy<span class="token punctuation">;</span>
    <span class="token keyword">vec3</span> color <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> colorShift <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>iResolution<span class="token punctuation">.</span>xy<span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> uv1 <span class="token operator">=</span> uv<span class="token operator">+</span>colorShift<span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> uv2 <span class="token operator">=</span> uv<span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> uv3 <span class="token operator">=</span> uv<span class="token operator">-</span>colorShift<span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> axis1 <span class="token operator">=</span> <span class="token function">rot</span><span class="token punctuation">(</span><span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.105</span><span class="token operator">/</span>iResolution<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">15.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec2</span> axis2 <span class="token operator">=</span> <span class="token function">rot</span><span class="token punctuation">(</span><span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.953</span><span class="token operator">/</span>iResolution<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">+</span><span class="token number">65.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">float</span> delta <span class="token operator">=</span> <span class="token number">0.</span><span class="token punctuation">;</span> delta<span class="token operator">&lt;</span> n<span class="token punctuation">;</span>delta<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">float</span> scale <span class="token operator">=</span> <span class="token number">.0625</span><span class="token operator">*</span><span class="token number">.0625</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token operator">-</span><span class="token number">.9875</span><span class="token operator">*</span>delta<span class="token operator">/</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d1r <span class="token operator">=</span> delta<span class="token operator">*</span><span class="token function">rot</span><span class="token punctuation">(</span>axis1<span class="token punctuation">,</span><span class="token operator">-</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d1g <span class="token operator">=</span> delta<span class="token operator">*</span>axis1<span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d1b <span class="token operator">=</span> delta<span class="token operator">*</span><span class="token function">rot</span><span class="token punctuation">(</span>axis1<span class="token punctuation">,</span><span class="token operator">+</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texR1 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv1<span class="token operator">+</span>d1r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texR2 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv1<span class="token operator">-</span>d1r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texG1 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv2<span class="token operator">+</span>d1g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texG2 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv2<span class="token operator">-</span>d1g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texB1 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv3<span class="token operator">+</span>d1b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texB2 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv3<span class="token operator">-</span>d1b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec3</span> aberr1 <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texR1<span class="token operator">+</span>texR2<span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texG1<span class="token operator">+</span>texG2<span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texB1<span class="token operator">+</span>texB2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec3</span> col1 <span class="token operator">=</span> aberr1<span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span>aberr1<span class="token punctuation">.</span>r<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>aberr1<span class="token punctuation">.</span>g<span class="token punctuation">,</span>aberr1<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d2r <span class="token operator">=</span> delta<span class="token operator">*</span><span class="token function">rot</span><span class="token punctuation">(</span>axis2<span class="token punctuation">,</span><span class="token operator">+</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d2g <span class="token operator">=</span> delta<span class="token operator">*</span>axis2<span class="token punctuation">;</span>
        <span class="token keyword">vec2</span> d2b <span class="token operator">=</span> delta<span class="token operator">*</span><span class="token function">rot</span><span class="token punctuation">(</span>axis2<span class="token punctuation">,</span><span class="token operator">-</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texR3 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv1<span class="token operator">+</span>d2r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texR4 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv1<span class="token operator">-</span>d2r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texG3 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv2<span class="token operator">+</span>d2g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texG4 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv2<span class="token operator">-</span>d2g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texB3 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv3<span class="token operator">+</span>d2b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec4</span> texB4 <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span> <span class="token function">saturate</span><span class="token punctuation">(</span>uv3<span class="token operator">-</span>d2b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec3</span> aberr2 <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texR3<span class="token operator">+</span>texR4<span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texG3<span class="token operator">+</span>texG4<span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token function">dot</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>texB3<span class="token operator">+</span>texB4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec3</span> col2 <span class="token operator">=</span> aberr2<span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span>aberr2<span class="token punctuation">.</span>r<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>aberr2<span class="token punctuation">.</span>g<span class="token punctuation">,</span>aberr2<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">vec3</span> col <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span>scale<span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3.7</span><span class="token punctuation">,</span><span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">5.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        color<span class="token operator">+=</span>col<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token function">mix</span><span class="token punctuation">(</span><span class="token function">texture</span><span class="token punctuation">(</span>iChannel0<span class="token punctuation">,</span>uv<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> color<span class="token punctuation">,</span>
                         <span class="token function">smoothstep</span><span class="token punctuation">(</span><span class="token number">.01</span><span class="token punctuation">,</span><span class="token number">.2</span><span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>uv<span class="token punctuation">.</span>x<span class="token punctuation">,</span>uv<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>
                         <span class="token function">smoothstep</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">.99</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">.8</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token function">max</span><span class="token punctuation">(</span>uv<span class="token punctuation">.</span>x<span class="token punctuation">,</span>uv<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">vec4</span> res <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>iChannel1<span class="token punctuation">,</span>uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fragColor <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token operator">*</span>fragColor<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">.0010625</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
        			<span class="token keyword">vec4</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>rgb<span class="token operator">/</span>res<span class="token punctuation">.</span>a<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="研究效果" tabindex="-1"><a class="header-anchor" href="#研究效果" aria-hidden="true">#</a> 研究效果</h2><p>研究还算是比较成功的，并且在 AMD 6800H 的核显可以流畅的渲染出以下图像。</p><h3 id="自发光、辉光、镜中镜" tabindex="-1"><a class="header-anchor" href="#自发光、辉光、镜中镜" aria-hidden="true">#</a> 自发光、辉光、镜中镜</h3><p><img src="/assets/mim2.e8d8fd9d.jpg" alt="mim2"></p><div style="page-break-after:always;"></div><h3 id="玻璃中的空气-空气中的玻璃" tabindex="-1"><a class="header-anchor" href="#玻璃中的空气-空气中的玻璃" aria-hidden="true">#</a> 玻璃中的空气，空气中的玻璃</h3><p><img src="/assets/image-20221229172858869.7620319e.png" alt="image-20221229172858869"></p><div style="page-break-after:always;"></div><h3 id="光圈、景深、对焦测试" tabindex="-1"><a class="header-anchor" href="#光圈、景深、对焦测试" aria-hidden="true">#</a> 光圈、景深、对焦测试</h3><p><img src="/assets/Blank-9-Grids-Collage.3ddc34f6.jpg" alt="Blank 9 Grids Collage"></p><div style="page-break-after:always;"></div><h3 id="人脸模型、茶壶模型、各种材质" tabindex="-1"><a class="header-anchor" href="#人脸模型、茶壶模型、各种材质" aria-hidden="true">#</a> 人脸模型、茶壶模型、各种材质</h3><table><thead><tr><th><img src="/assets/image-20221229173331073.f75d6462.png" alt="image-20221229173331073"></th><th><img src="/assets/image-20221229173422899.d00ddda1.png" alt="image-20221229173422899"></th></tr></thead></table><h3 id="自发光绿球、镜子面对面" tabindex="-1"><a class="header-anchor" href="#自发光绿球、镜子面对面" aria-hidden="true">#</a> 自发光绿球、镜子面对面</h3><p><img src="/assets/image-20221229173531354.fe3cfb0a.png" alt="image-20221229173531354"></p><h2 id="不足之处" tabindex="-1"><a class="header-anchor" href="#不足之处" aria-hidden="true">#</a> 不足之处</h2><p>在渲染上还有很多需要进一步优化和提升的点。</p><h3 id="todo" tabindex="-1"><a class="header-anchor" href="#todo" aria-hidden="true">#</a> ToDo</h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> Bloom&amp;Glow: 进一步辉光和泛光后处理提高画面质量</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> Checkerboard Rendering: 棋盘渲染提高渲染性能并增加分辨率</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> Reprojection: 摄像机位置改变，用历史的画面加速采样并起到降噪效果</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> Light Sources: 对光源的特殊采样</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> Importance Sampling: 重要性采样</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> Spectral Rendering: 光谱渲染，渲染焦散色散色差等</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> Mesh Rendering: 网格渲染</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> Voxel Rendering: 体素渲染</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> Volume Rendering: 体积渲染</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> Bouding Volume Hierarchy: 层次包围体求交加速</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> Further noise reduction: 在低 SPP 下进一步降噪等</label></li></ul><h3 id="展望" tabindex="-1"><a class="header-anchor" href="#展望" aria-hidden="true">#</a> 展望</h3><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> 一个更好的 GUI 对各种参数调整</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-12" disabled="disabled"><label class="task-list-item-label" for="task-item-12"> 其它资源（例如 HDR 图、模型文件等）的读取</label></li></ul><h2 id="致谢" tabindex="-1"><a class="header-anchor" href="#致谢" aria-hidden="true">#</a> 致谢</h2><p>感谢蔡逸彬和 Keyu Lu 同学帮助我跟进了其中一些研究内容。还非常感谢 Taichi 图形对我进行了支持，以及 GAMES104 、Shadertoy 里的大佬。还特别感谢 @ycz 大佬的文章对我有不少启发。</p><h2 id="附录" tabindex="-1"><a class="header-anchor" href="#附录" aria-hidden="true">#</a> 附录</h2><p>关于本程序，您可以在网页上直接运行（需使用算力足够且系统和浏览器较新的计算机）</p><ul><li><a href="https://www.shadertoy.com/view/ddSSWy" target="_blank" rel="noopener noreferrer">https://www.shadertoy.com/view/ddSSWy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></li><li><a href="https://raytracing.shao.fun" target="_blank" rel="noopener noreferrer">raytracing.shao.fun<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></li></ul><p>本项目全部代码已经在 GitHub 开源，请参考</p><ul><li><a href="https://github.com/HK-SHAO/RayTracingPBR" target="_blank" rel="noopener noreferrer">HK-SHAO/RayTracingPBR: Ray Tracing PBR for Taichi Hackathon 2022 (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></li><li><a href="https://gist.github.com/HK-SHAO/e142e3889270d353e3acae5bf3e1a82a" target="_blank" rel="noopener noreferrer">RayTracing PBR with Free Camera in ShaderToy (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>HK-SHAO. Taichi: 从零开始的光线追踪. <a href="https://shao.fun/blog/w/taichi-ray-tracing.html" target="_blank" rel="noopener noreferrer">https://shao.fun/blog/w/taichi-ray-tracing.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>. <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>sIBL Archive. sIBL Archive. <a href="http://www.hdrlabs.com/sibl/archive.html" target="_blank" rel="noopener noreferrer">http://www.hdrlabs.com/sibl/archive.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>. <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p>Matt Taylor. Tone Mapping. <a href="https://64.github.io/tonemapping/" target="_blank" rel="noopener noreferrer">https://64.github.io/tonemapping/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>. <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p>Keyu Lu. 光线追踪实时渲染降噪 (WIP). <a href="https://shao.fun/blog/w/ray-tracing-denoise.html" target="_blank" rel="noopener noreferrer">https://shao.fun/blog/w/ray-tracing-denoise.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span></a>. <a href="#footnote-ref4" class="footnote-backref">↩︎</a></p></li></ol></section></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/HK-SHAO/HK-SHAO.github.io/edit/main/src/blog/s/20221231DIP.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">在新窗口打开</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hk-shao@foxmail.com">HK-SHAO</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!--]--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.d9ef6744.js" defer></script>
  </body>
</html>
